(**********************************************************************************)
(*  Fingerboard - a microtonal geography of the cello fingerboard                 *)
(*  Copyright (C) 2022-2024 Mathieu Barbin <mathieu.barbin@gmail.com>             *)
(*                                                                                *)
(*  This file is part of Fingerboard.                                             *)
(*                                                                                *)
(*  Fingerboard is free software: you can redistribute it and/or modify it under  *)
(*  the terms of the GNU Affero General Public License as published by the Free   *)
(*  Software Foundation, either version 3 of the License, or any later version.   *)
(*                                                                                *)
(*  Fingerboard is distributed in the hope that it will be useful, but WITHOUT    *)
(*  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or         *)
(*  FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License   *)
(*  for more details.                                                             *)
(*                                                                                *)
(*  You should have received a copy of the GNU Affero General Public License      *)
(*  along with Fingerboard. If not, see <https://www.gnu.org/licenses/>.          *)
(**********************************************************************************)

let make_scale ~characterized_scale ~from =
  let t = force Pythagorean.t in
  System.Double_stops.make_scale
    t
    ~characterized_scale
    ~interval_number:Sixth
    ~from
    ~to_:Cello.fingerboard_highest_note
;;

let make_major_scale ~from =
  make_scale ~characterized_scale:Characterized_scale.major_pythagorean ~from
;;

let%expect_test "c_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_c in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ C2  │ IV     │ 0     │ 0     │ A2   │ III    │ M2p   │ 204   │ M6 - 3^3 / 2^4 │ 906   │
    │ D2  │ IV     │ M2p   │ 204   │ B2   │ III    │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ E2  │ IV     │ M3p   │ 408   │ C3   │ III    │ 4p    │ 498   │ m6 - 2^7 / 3^4 │ 792   │
    │ F2  │ IV     │ 4p    │ 498   │ D3   │ III    │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ G2  │ III    │ 0     │ 0     │ E3   │ II     │ M2p   │ 204   │ M6 - 3^3 / 2^4 │ 906   │
    │ A2  │ III    │ M2p   │ 204   │ F3   │ II     │ m3p   │ 294   │ m6 - 2^7 / 3^4 │ 792   │
    │ B2  │ III    │ M3p   │ 408   │ G3   │ II     │ 4p    │ 498   │ m6 - 2^7 / 3^4 │ 792   │
    │ C3  │ III    │ 4p    │ 498   │ A3   │ II     │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ D3  │ II     │ 0     │ 0     │ B3   │ I      │ M2p   │ 204   │ M6 - 3^3 / 2^4 │ 906   │
    │ E3  │ II     │ M2p   │ 204   │ C4   │ I      │ m3p   │ 294   │ m6 - 2^7 / 3^4 │ 792   │
    │ F3  │ II     │ m3p   │ 294   │ D4   │ I      │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ G3  │ II     │ 4p    │ 498   │ E4   │ I      │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ A3  │ II     │ 5p    │ 702   │ F4   │ I      │ m6p   │ 792   │ m6 - 2^7 / 3^4 │ 792   │
    │ B3  │ II     │ M6p   │ 906   │ G4   │ I      │ m7p   │ 996   │ m6 - 2^7 / 3^4 │ 792   │
    │ C4  │ II     │ m7p   │ 996   │ A4   │ I      │ 0-1   │ 1200  │ M6 - 3^3 / 2^4 │ 906   │
    │ D4  │ II     │ 0-1   │ 1200  │ B4   │ I      │ M2p-1 │ 1404  │ M6 - 3^3 / 2^4 │ 906   │
    │ E4  │ II     │ M2p-1 │ 1404  │ C5   │ I      │ m3p-1 │ 1494  │ m6 - 2^7 / 3^4 │ 792   │
    │ F4  │ II     │ m3p-1 │ 1494  │ D5   │ I      │ 4p-1  │ 1698  │ M6 - 3^3 / 2^4 │ 906   │
    │ G4  │ II     │ 4p-1  │ 1698  │ E5   │ I      │ 5p-1  │ 1902  │ M6 - 3^3 / 2^4 │ 906   │
    │ A4  │ II     │ 5p-1  │ 1902  │ F5   │ I      │ m6p-1 │ 1992  │ m6 - 2^7 / 3^4 │ 792   │
    │ B4  │ II     │ M6p-1 │ 2106  │ G5   │ I      │ m7p-1 │ 2196  │ m6 - 2^7 / 3^4 │ 792   │
    │ C5  │ II     │ m7p-1 │ 2196  │ A5   │ I      │ 0-2   │ 2400  │ M6 - 3^3 / 2^4 │ 906   │
    │ D5  │ II     │ 0-2   │ 2400  │ B5   │ I      │ M2p-2 │ 2604  │ M6 - 3^3 / 2^4 │ 906   │
    │ E5  │ II     │ M2p-2 │ 2604  │ C6   │ I      │ m3p-2 │ 2694  │ m6 - 2^7 / 3^4 │ 792   │
    │ F5  │ II     │ m3p-2 │ 2694  │ D6   │ I      │ 4p-2  │ 2898  │ M6 - 3^3 / 2^4 │ 906   │
    │ G5  │ II     │ 4p-2  │ 2898  │ E6   │ I      │ 5p-2  │ 3102  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "c_sharp_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_c_sharp in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ C#2 │ IV     │ A1p   │ 114   │ A#2  │ III    │ A2p   │ 318   │ M6 - 3^3 / 2^4 │ 906   │
    │ D#2 │ IV     │ A2p   │ 318   │ B#2  │ III    │ A3p   │ 522   │ M6 - 3^3 / 2^4 │ 906   │
    │ E#2 │ IV     │ A3p   │ 522   │ C#3  │ III    │ A4p   │ 612   │ m6 - 2^7 / 3^4 │ 792   │
    │ F#2 │ IV     │ A4p   │ 612   │ D#3  │ III    │ A5p   │ 816   │ M6 - 3^3 / 2^4 │ 906   │
    │ G#2 │ III    │ A1p   │ 114   │ E#3  │ II     │ A2p   │ 318   │ M6 - 3^3 / 2^4 │ 906   │
    │ A#2 │ III    │ A2p   │ 318   │ F#3  │ II     │ M3p   │ 408   │ m6 - 2^7 / 3^4 │ 792   │
    │ B#2 │ III    │ A3p   │ 522   │ G#3  │ II     │ A4p   │ 612   │ m6 - 2^7 / 3^4 │ 792   │
    │ C#3 │ III    │ A4p   │ 612   │ A#3  │ II     │ A5p   │ 816   │ M6 - 3^3 / 2^4 │ 906   │
    │ D#3 │ II     │ A1p   │ 114   │ B#3  │ I      │ A2p   │ 318   │ M6 - 3^3 / 2^4 │ 906   │
    │ E#3 │ II     │ A2p   │ 318   │ C#4  │ I      │ M3p   │ 408   │ m6 - 2^7 / 3^4 │ 792   │
    │ F#3 │ II     │ M3p   │ 408   │ D#4  │ I      │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ G#3 │ II     │ A4p   │ 612   │ E#4  │ I      │ A5p   │ 816   │ M6 - 3^3 / 2^4 │ 906   │
    │ A#3 │ II     │ A5p   │ 816   │ F#4  │ I      │ M6p   │ 906   │ m6 - 2^7 / 3^4 │ 792   │
    │ B#3 │ II     │ A6p   │ 1020  │ G#4  │ I      │ M7p   │ 1110  │ m6 - 2^7 / 3^4 │ 792   │
    │ C#4 │ II     │ M7p   │ 1110  │ A#4  │ I      │ A1p-1 │ 1314  │ M6 - 3^3 / 2^4 │ 906   │
    │ D#4 │ II     │ A1p-1 │ 1314  │ B#4  │ I      │ A2p-1 │ 1518  │ M6 - 3^3 / 2^4 │ 906   │
    │ E#4 │ II     │ A2p-1 │ 1518  │ C#5  │ I      │ M3p-1 │ 1608  │ m6 - 2^7 / 3^4 │ 792   │
    │ F#4 │ II     │ M3p-1 │ 1608  │ D#5  │ I      │ A4p-1 │ 1812  │ M6 - 3^3 / 2^4 │ 906   │
    │ G#4 │ II     │ A4p-1 │ 1812  │ E#5  │ I      │ A5p-1 │ 2016  │ M6 - 3^3 / 2^4 │ 906   │
    │ A#4 │ II     │ A5p-1 │ 2016  │ F#5  │ I      │ M6p-1 │ 2106  │ m6 - 2^7 / 3^4 │ 792   │
    │ B#4 │ II     │ A6p-1 │ 2220  │ G#5  │ I      │ M7p-1 │ 2310  │ m6 - 2^7 / 3^4 │ 792   │
    │ C#5 │ II     │ M7p-1 │ 2310  │ A#5  │ I      │ A1p-2 │ 2514  │ M6 - 3^3 / 2^4 │ 906   │
    │ D#5 │ II     │ A1p-2 │ 2514  │ B#5  │ I      │ A2p-2 │ 2718  │ M6 - 3^3 / 2^4 │ 906   │
    │ E#5 │ II     │ A2p-2 │ 2718  │ C#6  │ I      │ M3p-2 │ 2808  │ m6 - 2^7 / 3^4 │ 792   │
    │ F#5 │ II     │ M3p-2 │ 2808  │ D#6  │ I      │ A4p-2 │ 3012  │ M6 - 3^3 / 2^4 │ 906   │
    │ G#5 │ II     │ A4p-2 │ 3012  │ E#6  │ I      │ A5p-2 │ 3216  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "d_flat_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_d_flat in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ Db2 │ IV     │ m2p   │ 90    │ Bb2  │ III    │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb2 │ IV     │ m3p   │ 294   │ C3   │ III    │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ F2  │ IV     │ 4p    │ 498   │ Db3  │ III    │ d5p   │ 588   │ m6 - 2^7 / 3^4 │ 792   │
    │ Gb2 │ IV     │ d5p   │ 588   │ Eb3  │ III    │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Ab2 │ III    │ m2p   │ 90    │ F3   │ II     │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb2 │ III    │ m3p   │ 294   │ Gb3  │ II     │ d4p   │ 384   │ m6 - 2^7 / 3^4 │ 792   │
    │ C3  │ III    │ 4p    │ 498   │ Ab3  │ II     │ d5p   │ 588   │ m6 - 2^7 / 3^4 │ 792   │
    │ Db3 │ III    │ d5p   │ 588   │ Bb3  │ II     │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb3 │ II     │ m2p   │ 90    │ C4   │ I      │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ F3  │ II     │ m3p   │ 294   │ Db4  │ I      │ d4p   │ 384   │ m6 - 2^7 / 3^4 │ 792   │
    │ Gb3 │ II     │ d4p   │ 384   │ Eb4  │ I      │ d5p   │ 588   │ M6 - 3^3 / 2^4 │ 906   │
    │ Ab3 │ II     │ d5p   │ 588   │ F4   │ I      │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb3 │ II     │ m6p   │ 792   │ Gb4  │ I      │ d7p   │ 882   │ m6 - 2^7 / 3^4 │ 792   │
    │ C4  │ II     │ m7p   │ 996   │ Ab4  │ I      │ d8p   │ 1086  │ m6 - 2^7 / 3^4 │ 792   │
    │ Db4 │ II     │ d8p   │ 1086  │ Bb4  │ I      │ m2p-1 │ 1290  │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb4 │ II     │ m2p-1 │ 1290  │ C5   │ I      │ m3p-1 │ 1494  │ M6 - 3^3 / 2^4 │ 906   │
    │ F4  │ II     │ m3p-1 │ 1494  │ Db5  │ I      │ d4p-1 │ 1584  │ m6 - 2^7 / 3^4 │ 792   │
    │ Gb4 │ II     │ d4p-1 │ 1584  │ Eb5  │ I      │ d5p-1 │ 1788  │ M6 - 3^3 / 2^4 │ 906   │
    │ Ab4 │ II     │ d5p-1 │ 1788  │ F5   │ I      │ m6p-1 │ 1992  │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb4 │ II     │ m6p-1 │ 1992  │ Gb5  │ I      │ d7p-1 │ 2082  │ m6 - 2^7 / 3^4 │ 792   │
    │ C5  │ II     │ m7p-1 │ 2196  │ Ab5  │ I      │ d8p-1 │ 2286  │ m6 - 2^7 / 3^4 │ 792   │
    │ Db5 │ II     │ d8p-1 │ 2286  │ Bb5  │ I      │ m2p-2 │ 2490  │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb5 │ II     │ m2p-2 │ 2490  │ C6   │ I      │ m3p-2 │ 2694  │ M6 - 3^3 / 2^4 │ 906   │
    │ F5  │ II     │ m3p-2 │ 2694  │ Db6  │ I      │ d4p-2 │ 2784  │ m6 - 2^7 / 3^4 │ 792   │
    │ Gb5 │ II     │ d4p-2 │ 2784  │ Eb6  │ I      │ d5p-2 │ 2988  │ M6 - 3^3 / 2^4 │ 906   │
    │ Ab5 │ II     │ d5p-2 │ 2988  │ F6   │ I      │ m6p-2 │ 3192  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "d_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_d in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ D2  │ IV     │ M2p   │ 204   │ B2   │ III    │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ E2  │ IV     │ M3p   │ 408   │ C#3  │ III    │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ F#2 │ IV     │ A4p   │ 612   │ D3   │ III    │ 5p    │ 702   │ m6 - 2^7 / 3^4 │ 792   │
    │ G2  │ III    │ 0     │ 0     │ E3   │ II     │ M2p   │ 204   │ M6 - 3^3 / 2^4 │ 906   │
    │ A2  │ III    │ M2p   │ 204   │ F#3  │ II     │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ B2  │ III    │ M3p   │ 408   │ G3   │ II     │ 4p    │ 498   │ m6 - 2^7 / 3^4 │ 792   │
    │ C#3 │ III    │ A4p   │ 612   │ A3   │ II     │ 5p    │ 702   │ m6 - 2^7 / 3^4 │ 792   │
    │ D3  │ II     │ 0     │ 0     │ B3   │ I      │ M2p   │ 204   │ M6 - 3^3 / 2^4 │ 906   │
    │ E3  │ II     │ M2p   │ 204   │ C#4  │ I      │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ F#3 │ II     │ M3p   │ 408   │ D4   │ I      │ 4p    │ 498   │ m6 - 2^7 / 3^4 │ 792   │
    │ G3  │ II     │ 4p    │ 498   │ E4   │ I      │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ A3  │ II     │ 5p    │ 702   │ F#4  │ I      │ M6p   │ 906   │ M6 - 3^3 / 2^4 │ 906   │
    │ B3  │ II     │ M6p   │ 906   │ G4   │ I      │ m7p   │ 996   │ m6 - 2^7 / 3^4 │ 792   │
    │ C#4 │ II     │ M7p   │ 1110  │ A4   │ I      │ 0-1   │ 1200  │ m6 - 2^7 / 3^4 │ 792   │
    │ D4  │ II     │ 0-1   │ 1200  │ B4   │ I      │ M2p-1 │ 1404  │ M6 - 3^3 / 2^4 │ 906   │
    │ E4  │ II     │ M2p-1 │ 1404  │ C#5  │ I      │ M3p-1 │ 1608  │ M6 - 3^3 / 2^4 │ 906   │
    │ F#4 │ II     │ M3p-1 │ 1608  │ D5   │ I      │ 4p-1  │ 1698  │ m6 - 2^7 / 3^4 │ 792   │
    │ G4  │ II     │ 4p-1  │ 1698  │ E5   │ I      │ 5p-1  │ 1902  │ M6 - 3^3 / 2^4 │ 906   │
    │ A4  │ II     │ 5p-1  │ 1902  │ F#5  │ I      │ M6p-1 │ 2106  │ M6 - 3^3 / 2^4 │ 906   │
    │ B4  │ II     │ M6p-1 │ 2106  │ G5   │ I      │ m7p-1 │ 2196  │ m6 - 2^7 / 3^4 │ 792   │
    │ C#5 │ II     │ M7p-1 │ 2310  │ A5   │ I      │ 0-2   │ 2400  │ m6 - 2^7 / 3^4 │ 792   │
    │ D5  │ II     │ 0-2   │ 2400  │ B5   │ I      │ M2p-2 │ 2604  │ M6 - 3^3 / 2^4 │ 906   │
    │ E5  │ II     │ M2p-2 │ 2604  │ C#6  │ I      │ M3p-2 │ 2808  │ M6 - 3^3 / 2^4 │ 906   │
    │ F#5 │ II     │ M3p-2 │ 2808  │ D6   │ I      │ 4p-2  │ 2898  │ m6 - 2^7 / 3^4 │ 792   │
    │ G5  │ II     │ 4p-2  │ 2898  │ E6   │ I      │ 5p-2  │ 3102  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "e_flat_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_e_flat in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ Eb2 │ IV     │ m3p   │ 294   │ C3   │ III    │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ F2  │ IV     │ 4p    │ 498   │ D3   │ III    │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ G2  │ III    │ 0     │ 0     │ Eb3  │ II     │ m2p   │ 90    │ m6 - 2^7 / 3^4 │ 792   │
    │ Ab2 │ III    │ m2p   │ 90    │ F3   │ II     │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb2 │ III    │ m3p   │ 294   │ G3   │ II     │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ C3  │ III    │ 4p    │ 498   │ Ab3  │ II     │ d5p   │ 588   │ m6 - 2^7 / 3^4 │ 792   │
    │ D3  │ II     │ 0     │ 0     │ Bb3  │ I      │ m2p   │ 90    │ m6 - 2^7 / 3^4 │ 792   │
    │ Eb3 │ II     │ m2p   │ 90    │ C4   │ I      │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ F3  │ II     │ m3p   │ 294   │ D4   │ I      │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ G3  │ II     │ 4p    │ 498   │ Eb4  │ I      │ d5p   │ 588   │ m6 - 2^7 / 3^4 │ 792   │
    │ Ab3 │ II     │ d5p   │ 588   │ F4   │ I      │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb3 │ II     │ m6p   │ 792   │ G4   │ I      │ m7p   │ 996   │ M6 - 3^3 / 2^4 │ 906   │
    │ C4  │ II     │ m7p   │ 996   │ Ab4  │ I      │ d8p   │ 1086  │ m6 - 2^7 / 3^4 │ 792   │
    │ D4  │ II     │ 0-1   │ 1200  │ Bb4  │ I      │ m2p-1 │ 1290  │ m6 - 2^7 / 3^4 │ 792   │
    │ Eb4 │ II     │ m2p-1 │ 1290  │ C5   │ I      │ m3p-1 │ 1494  │ M6 - 3^3 / 2^4 │ 906   │
    │ F4  │ II     │ m3p-1 │ 1494  │ D5   │ I      │ 4p-1  │ 1698  │ M6 - 3^3 / 2^4 │ 906   │
    │ G4  │ II     │ 4p-1  │ 1698  │ Eb5  │ I      │ d5p-1 │ 1788  │ m6 - 2^7 / 3^4 │ 792   │
    │ Ab4 │ II     │ d5p-1 │ 1788  │ F5   │ I      │ m6p-1 │ 1992  │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb4 │ II     │ m6p-1 │ 1992  │ G5   │ I      │ m7p-1 │ 2196  │ M6 - 3^3 / 2^4 │ 906   │
    │ C5  │ II     │ m7p-1 │ 2196  │ Ab5  │ I      │ d8p-1 │ 2286  │ m6 - 2^7 / 3^4 │ 792   │
    │ D5  │ II     │ 0-2   │ 2400  │ Bb5  │ I      │ m2p-2 │ 2490  │ m6 - 2^7 / 3^4 │ 792   │
    │ Eb5 │ II     │ m2p-2 │ 2490  │ C6   │ I      │ m3p-2 │ 2694  │ M6 - 3^3 / 2^4 │ 906   │
    │ F5  │ II     │ m3p-2 │ 2694  │ D6   │ I      │ 4p-2  │ 2898  │ M6 - 3^3 / 2^4 │ 906   │
    │ G5  │ II     │ 4p-2  │ 2898  │ Eb6  │ I      │ d5p-2 │ 2988  │ m6 - 2^7 / 3^4 │ 792   │
    │ Ab5 │ II     │ d5p-2 │ 2988  │ F6   │ I      │ m6p-2 │ 3192  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "e_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_e in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ E2  │ IV     │ M3p   │ 408   │ C#3  │ III    │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ F#2 │ IV     │ A4p   │ 612   │ D#3  │ III    │ A5p   │ 816   │ M6 - 3^3 / 2^4 │ 906   │
    │ G#2 │ III    │ A1p   │ 114   │ E3   │ II     │ M2p   │ 204   │ m6 - 2^7 / 3^4 │ 792   │
    │ A2  │ III    │ M2p   │ 204   │ F#3  │ II     │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ B2  │ III    │ M3p   │ 408   │ G#3  │ II     │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ C#3 │ III    │ A4p   │ 612   │ A3   │ II     │ 5p    │ 702   │ m6 - 2^7 / 3^4 │ 792   │
    │ D#3 │ II     │ A1p   │ 114   │ B3   │ I      │ M2p   │ 204   │ m6 - 2^7 / 3^4 │ 792   │
    │ E3  │ II     │ M2p   │ 204   │ C#4  │ I      │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ F#3 │ II     │ M3p   │ 408   │ D#4  │ I      │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ G#3 │ II     │ A4p   │ 612   │ E4   │ I      │ 5p    │ 702   │ m6 - 2^7 / 3^4 │ 792   │
    │ A3  │ II     │ 5p    │ 702   │ F#4  │ I      │ M6p   │ 906   │ M6 - 3^3 / 2^4 │ 906   │
    │ B3  │ II     │ M6p   │ 906   │ G#4  │ I      │ M7p   │ 1110  │ M6 - 3^3 / 2^4 │ 906   │
    │ C#4 │ II     │ M7p   │ 1110  │ A4   │ I      │ 0-1   │ 1200  │ m6 - 2^7 / 3^4 │ 792   │
    │ D#4 │ II     │ A1p-1 │ 1314  │ B4   │ I      │ M2p-1 │ 1404  │ m6 - 2^7 / 3^4 │ 792   │
    │ E4  │ II     │ M2p-1 │ 1404  │ C#5  │ I      │ M3p-1 │ 1608  │ M6 - 3^3 / 2^4 │ 906   │
    │ F#4 │ II     │ M3p-1 │ 1608  │ D#5  │ I      │ A4p-1 │ 1812  │ M6 - 3^3 / 2^4 │ 906   │
    │ G#4 │ II     │ A4p-1 │ 1812  │ E5   │ I      │ 5p-1  │ 1902  │ m6 - 2^7 / 3^4 │ 792   │
    │ A4  │ II     │ 5p-1  │ 1902  │ F#5  │ I      │ M6p-1 │ 2106  │ M6 - 3^3 / 2^4 │ 906   │
    │ B4  │ II     │ M6p-1 │ 2106  │ G#5  │ I      │ M7p-1 │ 2310  │ M6 - 3^3 / 2^4 │ 906   │
    │ C#5 │ II     │ M7p-1 │ 2310  │ A5   │ I      │ 0-2   │ 2400  │ m6 - 2^7 / 3^4 │ 792   │
    │ D#5 │ II     │ A1p-2 │ 2514  │ B5   │ I      │ M2p-2 │ 2604  │ m6 - 2^7 / 3^4 │ 792   │
    │ E5  │ II     │ M2p-2 │ 2604  │ C#6  │ I      │ M3p-2 │ 2808  │ M6 - 3^3 / 2^4 │ 906   │
    │ F#5 │ II     │ M3p-2 │ 2808  │ D#6  │ I      │ A4p-2 │ 3012  │ M6 - 3^3 / 2^4 │ 906   │
    │ G#5 │ II     │ A4p-2 │ 3012  │ E6   │ I      │ 5p-2  │ 3102  │ m6 - 2^7 / 3^4 │ 792   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "f_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_f in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ F2  │ IV     │ 4p    │ 498   │ D3   │ III    │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ G2  │ III    │ 0     │ 0     │ E3   │ II     │ M2p   │ 204   │ M6 - 3^3 / 2^4 │ 906   │
    │ A2  │ III    │ M2p   │ 204   │ F3   │ II     │ m3p   │ 294   │ m6 - 2^7 / 3^4 │ 792   │
    │ Bb2 │ III    │ m3p   │ 294   │ G3   │ II     │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ C3  │ III    │ 4p    │ 498   │ A3   │ II     │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ D3  │ II     │ 0     │ 0     │ Bb3  │ I      │ m2p   │ 90    │ m6 - 2^7 / 3^4 │ 792   │
    │ E3  │ II     │ M2p   │ 204   │ C4   │ I      │ m3p   │ 294   │ m6 - 2^7 / 3^4 │ 792   │
    │ F3  │ II     │ m3p   │ 294   │ D4   │ I      │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ G3  │ II     │ 4p    │ 498   │ E4   │ I      │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ A3  │ II     │ 5p    │ 702   │ F4   │ I      │ m6p   │ 792   │ m6 - 2^7 / 3^4 │ 792   │
    │ Bb3 │ II     │ m6p   │ 792   │ G4   │ I      │ m7p   │ 996   │ M6 - 3^3 / 2^4 │ 906   │
    │ C4  │ II     │ m7p   │ 996   │ A4   │ I      │ 0-1   │ 1200  │ M6 - 3^3 / 2^4 │ 906   │
    │ D4  │ II     │ 0-1   │ 1200  │ Bb4  │ I      │ m2p-1 │ 1290  │ m6 - 2^7 / 3^4 │ 792   │
    │ E4  │ II     │ M2p-1 │ 1404  │ C5   │ I      │ m3p-1 │ 1494  │ m6 - 2^7 / 3^4 │ 792   │
    │ F4  │ II     │ m3p-1 │ 1494  │ D5   │ I      │ 4p-1  │ 1698  │ M6 - 3^3 / 2^4 │ 906   │
    │ G4  │ II     │ 4p-1  │ 1698  │ E5   │ I      │ 5p-1  │ 1902  │ M6 - 3^3 / 2^4 │ 906   │
    │ A4  │ II     │ 5p-1  │ 1902  │ F5   │ I      │ m6p-1 │ 1992  │ m6 - 2^7 / 3^4 │ 792   │
    │ Bb4 │ II     │ m6p-1 │ 1992  │ G5   │ I      │ m7p-1 │ 2196  │ M6 - 3^3 / 2^4 │ 906   │
    │ C5  │ II     │ m7p-1 │ 2196  │ A5   │ I      │ 0-2   │ 2400  │ M6 - 3^3 / 2^4 │ 906   │
    │ D5  │ II     │ 0-2   │ 2400  │ Bb5  │ I      │ m2p-2 │ 2490  │ m6 - 2^7 / 3^4 │ 792   │
    │ E5  │ II     │ M2p-2 │ 2604  │ C6   │ I      │ m3p-2 │ 2694  │ m6 - 2^7 / 3^4 │ 792   │
    │ F5  │ II     │ m3p-2 │ 2694  │ D6   │ I      │ 4p-2  │ 2898  │ M6 - 3^3 / 2^4 │ 906   │
    │ G5  │ II     │ 4p-2  │ 2898  │ E6   │ I      │ 5p-2  │ 3102  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "f_sharp_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_f_sharp in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ F#2 │ IV     │ A4p   │ 612   │ D#3  │ III    │ A5p   │ 816   │ M6 - 3^3 / 2^4 │ 906   │
    │ G#2 │ III    │ A1p   │ 114   │ E#3  │ II     │ A2p   │ 318   │ M6 - 3^3 / 2^4 │ 906   │
    │ A#2 │ III    │ A2p   │ 318   │ F#3  │ II     │ M3p   │ 408   │ m6 - 2^7 / 3^4 │ 792   │
    │ B2  │ III    │ M3p   │ 408   │ G#3  │ II     │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ C#3 │ III    │ A4p   │ 612   │ A#3  │ II     │ A5p   │ 816   │ M6 - 3^3 / 2^4 │ 906   │
    │ D#3 │ II     │ A1p   │ 114   │ B3   │ I      │ M2p   │ 204   │ m6 - 2^7 / 3^4 │ 792   │
    │ E#3 │ II     │ A2p   │ 318   │ C#4  │ I      │ M3p   │ 408   │ m6 - 2^7 / 3^4 │ 792   │
    │ F#3 │ II     │ M3p   │ 408   │ D#4  │ I      │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ G#3 │ II     │ A4p   │ 612   │ E#4  │ I      │ A5p   │ 816   │ M6 - 3^3 / 2^4 │ 906   │
    │ A#3 │ II     │ A5p   │ 816   │ F#4  │ I      │ M6p   │ 906   │ m6 - 2^7 / 3^4 │ 792   │
    │ B3  │ II     │ M6p   │ 906   │ G#4  │ I      │ M7p   │ 1110  │ M6 - 3^3 / 2^4 │ 906   │
    │ C#4 │ II     │ M7p   │ 1110  │ A#4  │ I      │ A1p-1 │ 1314  │ M6 - 3^3 / 2^4 │ 906   │
    │ D#4 │ II     │ A1p-1 │ 1314  │ B4   │ I      │ M2p-1 │ 1404  │ m6 - 2^7 / 3^4 │ 792   │
    │ E#4 │ II     │ A2p-1 │ 1518  │ C#5  │ I      │ M3p-1 │ 1608  │ m6 - 2^7 / 3^4 │ 792   │
    │ F#4 │ II     │ M3p-1 │ 1608  │ D#5  │ I      │ A4p-1 │ 1812  │ M6 - 3^3 / 2^4 │ 906   │
    │ G#4 │ II     │ A4p-1 │ 1812  │ E#5  │ I      │ A5p-1 │ 2016  │ M6 - 3^3 / 2^4 │ 906   │
    │ A#4 │ II     │ A5p-1 │ 2016  │ F#5  │ I      │ M6p-1 │ 2106  │ m6 - 2^7 / 3^4 │ 792   │
    │ B4  │ II     │ M6p-1 │ 2106  │ G#5  │ I      │ M7p-1 │ 2310  │ M6 - 3^3 / 2^4 │ 906   │
    │ C#5 │ II     │ M7p-1 │ 2310  │ A#5  │ I      │ A1p-2 │ 2514  │ M6 - 3^3 / 2^4 │ 906   │
    │ D#5 │ II     │ A1p-2 │ 2514  │ B5   │ I      │ M2p-2 │ 2604  │ m6 - 2^7 / 3^4 │ 792   │
    │ E#5 │ II     │ A2p-2 │ 2718  │ C#6  │ I      │ M3p-2 │ 2808  │ m6 - 2^7 / 3^4 │ 792   │
    │ F#5 │ II     │ M3p-2 │ 2808  │ D#6  │ I      │ A4p-2 │ 3012  │ M6 - 3^3 / 2^4 │ 906   │
    │ G#5 │ II     │ A4p-2 │ 3012  │ E#6  │ I      │ A5p-2 │ 3216  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "g_flat_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_g_flat in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ Gb2 │ IV     │ d5p   │ 588   │ Eb3  │ III    │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Ab2 │ III    │ m2p   │ 90    │ F3   │ II     │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb2 │ III    │ m3p   │ 294   │ Gb3  │ II     │ d4p   │ 384   │ m6 - 2^7 / 3^4 │ 792   │
    │ Cb3 │ III    │ d4p   │ 384   │ Ab3  │ II     │ d5p   │ 588   │ M6 - 3^3 / 2^4 │ 906   │
    │ Db3 │ III    │ d5p   │ 588   │ Bb3  │ II     │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb3 │ II     │ m2p   │ 90    │ Cb4  │ I      │ d3p   │ 180   │ m6 - 2^7 / 3^4 │ 792   │
    │ F3  │ II     │ m3p   │ 294   │ Db4  │ I      │ d4p   │ 384   │ m6 - 2^7 / 3^4 │ 792   │
    │ Gb3 │ II     │ d4p   │ 384   │ Eb4  │ I      │ d5p   │ 588   │ M6 - 3^3 / 2^4 │ 906   │
    │ Ab3 │ II     │ d5p   │ 588   │ F4   │ I      │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb3 │ II     │ m6p   │ 792   │ Gb4  │ I      │ d7p   │ 882   │ m6 - 2^7 / 3^4 │ 792   │
    │ Cb4 │ II     │ d7p   │ 882   │ Ab4  │ I      │ d8p   │ 1086  │ M6 - 3^3 / 2^4 │ 906   │
    │ Db4 │ II     │ d8p   │ 1086  │ Bb4  │ I      │ m2p-1 │ 1290  │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb4 │ II     │ m2p-1 │ 1290  │ Cb5  │ I      │ d3p-1 │ 1380  │ m6 - 2^7 / 3^4 │ 792   │
    │ F4  │ II     │ m3p-1 │ 1494  │ Db5  │ I      │ d4p-1 │ 1584  │ m6 - 2^7 / 3^4 │ 792   │
    │ Gb4 │ II     │ d4p-1 │ 1584  │ Eb5  │ I      │ d5p-1 │ 1788  │ M6 - 3^3 / 2^4 │ 906   │
    │ Ab4 │ II     │ d5p-1 │ 1788  │ F5   │ I      │ m6p-1 │ 1992  │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb4 │ II     │ m6p-1 │ 1992  │ Gb5  │ I      │ d7p-1 │ 2082  │ m6 - 2^7 / 3^4 │ 792   │
    │ Cb5 │ II     │ d7p-1 │ 2082  │ Ab5  │ I      │ d8p-1 │ 2286  │ M6 - 3^3 / 2^4 │ 906   │
    │ Db5 │ II     │ d8p-1 │ 2286  │ Bb5  │ I      │ m2p-2 │ 2490  │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb5 │ II     │ m2p-2 │ 2490  │ Cb6  │ I      │ d3p-2 │ 2580  │ m6 - 2^7 / 3^4 │ 792   │
    │ F5  │ II     │ m3p-2 │ 2694  │ Db6  │ I      │ d4p-2 │ 2784  │ m6 - 2^7 / 3^4 │ 792   │
    │ Gb5 │ II     │ d4p-2 │ 2784  │ Eb6  │ I      │ d5p-2 │ 2988  │ M6 - 3^3 / 2^4 │ 906   │
    │ Ab5 │ II     │ d5p-2 │ 2988  │ F6   │ I      │ m6p-2 │ 3192  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "g_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_f in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ F2  │ IV     │ 4p    │ 498   │ D3   │ III    │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ G2  │ III    │ 0     │ 0     │ E3   │ II     │ M2p   │ 204   │ M6 - 3^3 / 2^4 │ 906   │
    │ A2  │ III    │ M2p   │ 204   │ F3   │ II     │ m3p   │ 294   │ m6 - 2^7 / 3^4 │ 792   │
    │ Bb2 │ III    │ m3p   │ 294   │ G3   │ II     │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ C3  │ III    │ 4p    │ 498   │ A3   │ II     │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ D3  │ II     │ 0     │ 0     │ Bb3  │ I      │ m2p   │ 90    │ m6 - 2^7 / 3^4 │ 792   │
    │ E3  │ II     │ M2p   │ 204   │ C4   │ I      │ m3p   │ 294   │ m6 - 2^7 / 3^4 │ 792   │
    │ F3  │ II     │ m3p   │ 294   │ D4   │ I      │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ G3  │ II     │ 4p    │ 498   │ E4   │ I      │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ A3  │ II     │ 5p    │ 702   │ F4   │ I      │ m6p   │ 792   │ m6 - 2^7 / 3^4 │ 792   │
    │ Bb3 │ II     │ m6p   │ 792   │ G4   │ I      │ m7p   │ 996   │ M6 - 3^3 / 2^4 │ 906   │
    │ C4  │ II     │ m7p   │ 996   │ A4   │ I      │ 0-1   │ 1200  │ M6 - 3^3 / 2^4 │ 906   │
    │ D4  │ II     │ 0-1   │ 1200  │ Bb4  │ I      │ m2p-1 │ 1290  │ m6 - 2^7 / 3^4 │ 792   │
    │ E4  │ II     │ M2p-1 │ 1404  │ C5   │ I      │ m3p-1 │ 1494  │ m6 - 2^7 / 3^4 │ 792   │
    │ F4  │ II     │ m3p-1 │ 1494  │ D5   │ I      │ 4p-1  │ 1698  │ M6 - 3^3 / 2^4 │ 906   │
    │ G4  │ II     │ 4p-1  │ 1698  │ E5   │ I      │ 5p-1  │ 1902  │ M6 - 3^3 / 2^4 │ 906   │
    │ A4  │ II     │ 5p-1  │ 1902  │ F5   │ I      │ m6p-1 │ 1992  │ m6 - 2^7 / 3^4 │ 792   │
    │ Bb4 │ II     │ m6p-1 │ 1992  │ G5   │ I      │ m7p-1 │ 2196  │ M6 - 3^3 / 2^4 │ 906   │
    │ C5  │ II     │ m7p-1 │ 2196  │ A5   │ I      │ 0-2   │ 2400  │ M6 - 3^3 / 2^4 │ 906   │
    │ D5  │ II     │ 0-2   │ 2400  │ Bb5  │ I      │ m2p-2 │ 2490  │ m6 - 2^7 / 3^4 │ 792   │
    │ E5  │ II     │ M2p-2 │ 2604  │ C6   │ I      │ m3p-2 │ 2694  │ m6 - 2^7 / 3^4 │ 792   │
    │ F5  │ II     │ m3p-2 │ 2694  │ D6   │ I      │ 4p-2  │ 2898  │ M6 - 3^3 / 2^4 │ 906   │
    │ G5  │ II     │ 4p-2  │ 2898  │ E6   │ I      │ 5p-2  │ 3102  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "a_flat_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_a_flat in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ Ab2 │ III    │ m2p   │ 90    │ F3   │ II     │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb2 │ III    │ m3p   │ 294   │ G3   │ II     │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ C3  │ III    │ 4p    │ 498   │ Ab3  │ II     │ d5p   │ 588   │ m6 - 2^7 / 3^4 │ 792   │
    │ Db3 │ III    │ d5p   │ 588   │ Bb3  │ II     │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb3 │ II     │ m2p   │ 90    │ C4   │ I      │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ F3  │ II     │ m3p   │ 294   │ Db4  │ I      │ d4p   │ 384   │ m6 - 2^7 / 3^4 │ 792   │
    │ G3  │ II     │ 4p    │ 498   │ Eb4  │ I      │ d5p   │ 588   │ m6 - 2^7 / 3^4 │ 792   │
    │ Ab3 │ II     │ d5p   │ 588   │ F4   │ I      │ m6p   │ 792   │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb3 │ II     │ m6p   │ 792   │ G4   │ I      │ m7p   │ 996   │ M6 - 3^3 / 2^4 │ 906   │
    │ C4  │ II     │ m7p   │ 996   │ Ab4  │ I      │ d8p   │ 1086  │ m6 - 2^7 / 3^4 │ 792   │
    │ Db4 │ II     │ d8p   │ 1086  │ Bb4  │ I      │ m2p-1 │ 1290  │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb4 │ II     │ m2p-1 │ 1290  │ C5   │ I      │ m3p-1 │ 1494  │ M6 - 3^3 / 2^4 │ 906   │
    │ F4  │ II     │ m3p-1 │ 1494  │ Db5  │ I      │ d4p-1 │ 1584  │ m6 - 2^7 / 3^4 │ 792   │
    │ G4  │ II     │ 4p-1  │ 1698  │ Eb5  │ I      │ d5p-1 │ 1788  │ m6 - 2^7 / 3^4 │ 792   │
    │ Ab4 │ II     │ d5p-1 │ 1788  │ F5   │ I      │ m6p-1 │ 1992  │ M6 - 3^3 / 2^4 │ 906   │
    │ Bb4 │ II     │ m6p-1 │ 1992  │ G5   │ I      │ m7p-1 │ 2196  │ M6 - 3^3 / 2^4 │ 906   │
    │ C5  │ II     │ m7p-1 │ 2196  │ Ab5  │ I      │ d8p-1 │ 2286  │ m6 - 2^7 / 3^4 │ 792   │
    │ Db5 │ II     │ d8p-1 │ 2286  │ Bb5  │ I      │ m2p-2 │ 2490  │ M6 - 3^3 / 2^4 │ 906   │
    │ Eb5 │ II     │ m2p-2 │ 2490  │ C6   │ I      │ m3p-2 │ 2694  │ M6 - 3^3 / 2^4 │ 906   │
    │ F5  │ II     │ m3p-2 │ 2694  │ Db6  │ I      │ d4p-2 │ 2784  │ m6 - 2^7 / 3^4 │ 792   │
    │ G5  │ II     │ 4p-2  │ 2898  │ Eb6  │ I      │ d5p-2 │ 2988  │ m6 - 2^7 / 3^4 │ 792   │
    │ Ab5 │ II     │ d5p-2 │ 2988  │ F6   │ I      │ m6p-2 │ 3192  │ M6 - 3^3 / 2^4 │ 906   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "a_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_a in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ A2  │ III    │ M2p   │ 204   │ F#3  │ II     │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ B2  │ III    │ M3p   │ 408   │ G#3  │ II     │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ C#3 │ III    │ A4p   │ 612   │ A3   │ II     │ 5p    │ 702   │ m6 - 2^7 / 3^4 │ 792   │
    │ D3  │ II     │ 0     │ 0     │ B3   │ I      │ M2p   │ 204   │ M6 - 3^3 / 2^4 │ 906   │
    │ E3  │ II     │ M2p   │ 204   │ C#4  │ I      │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ F#3 │ II     │ M3p   │ 408   │ D4   │ I      │ 4p    │ 498   │ m6 - 2^7 / 3^4 │ 792   │
    │ G#3 │ II     │ A4p   │ 612   │ E4   │ I      │ 5p    │ 702   │ m6 - 2^7 / 3^4 │ 792   │
    │ A3  │ II     │ 5p    │ 702   │ F#4  │ I      │ M6p   │ 906   │ M6 - 3^3 / 2^4 │ 906   │
    │ B3  │ II     │ M6p   │ 906   │ G#4  │ I      │ M7p   │ 1110  │ M6 - 3^3 / 2^4 │ 906   │
    │ C#4 │ II     │ M7p   │ 1110  │ A4   │ I      │ 0-1   │ 1200  │ m6 - 2^7 / 3^4 │ 792   │
    │ D4  │ II     │ 0-1   │ 1200  │ B4   │ I      │ M2p-1 │ 1404  │ M6 - 3^3 / 2^4 │ 906   │
    │ E4  │ II     │ M2p-1 │ 1404  │ C#5  │ I      │ M3p-1 │ 1608  │ M6 - 3^3 / 2^4 │ 906   │
    │ F#4 │ II     │ M3p-1 │ 1608  │ D5   │ I      │ 4p-1  │ 1698  │ m6 - 2^7 / 3^4 │ 792   │
    │ G#4 │ II     │ A4p-1 │ 1812  │ E5   │ I      │ 5p-1  │ 1902  │ m6 - 2^7 / 3^4 │ 792   │
    │ A4  │ II     │ 5p-1  │ 1902  │ F#5  │ I      │ M6p-1 │ 2106  │ M6 - 3^3 / 2^4 │ 906   │
    │ B4  │ II     │ M6p-1 │ 2106  │ G#5  │ I      │ M7p-1 │ 2310  │ M6 - 3^3 / 2^4 │ 906   │
    │ C#5 │ II     │ M7p-1 │ 2310  │ A5   │ I      │ 0-2   │ 2400  │ m6 - 2^7 / 3^4 │ 792   │
    │ D5  │ II     │ 0-2   │ 2400  │ B5   │ I      │ M2p-2 │ 2604  │ M6 - 3^3 / 2^4 │ 906   │
    │ E5  │ II     │ M2p-2 │ 2604  │ C#6  │ I      │ M3p-2 │ 2808  │ M6 - 3^3 / 2^4 │ 906   │
    │ F#5 │ II     │ M3p-2 │ 2808  │ D6   │ I      │ 4p-2  │ 2898  │ m6 - 2^7 / 3^4 │ 792   │
    │ G#5 │ II     │ A4p-2 │ 3012  │ E6   │ I      │ 5p-2  │ 3102  │ m6 - 2^7 / 3^4 │ 792   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "b_flat_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_b_flat in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ Bb2 │ III    │ m3p   │ 294   │ G3   │ II     │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ C3  │ III    │ 4p    │ 498   │ A3   │ II     │ 5p    │ 702   │ M6 - 3^3 / 2^4 │ 906   │
    │ D3  │ II     │ 0     │ 0     │ Bb3  │ I      │ m2p   │ 90    │ m6 - 2^7 / 3^4 │ 792   │
    │ Eb3 │ II     │ m2p   │ 90    │ C4   │ I      │ m3p   │ 294   │ M6 - 3^3 / 2^4 │ 906   │
    │ F3  │ II     │ m3p   │ 294   │ D4   │ I      │ 4p    │ 498   │ M6 - 3^3 / 2^4 │ 906   │
    │ G3  │ II     │ 4p    │ 498   │ Eb4  │ I      │ d5p   │ 588   │ m6 - 2^7 / 3^4 │ 792   │
    │ A3  │ II     │ 5p    │ 702   │ F4   │ I      │ m6p   │ 792   │ m6 - 2^7 / 3^4 │ 792   │
    │ Bb3 │ II     │ m6p   │ 792   │ G4   │ I      │ m7p   │ 996   │ M6 - 3^3 / 2^4 │ 906   │
    │ C4  │ II     │ m7p   │ 996   │ A4   │ I      │ 0-1   │ 1200  │ M6 - 3^3 / 2^4 │ 906   │
    │ D4  │ II     │ 0-1   │ 1200  │ Bb4  │ I      │ m2p-1 │ 1290  │ m6 - 2^7 / 3^4 │ 792   │
    │ Eb4 │ II     │ m2p-1 │ 1290  │ C5   │ I      │ m3p-1 │ 1494  │ M6 - 3^3 / 2^4 │ 906   │
    │ F4  │ II     │ m3p-1 │ 1494  │ D5   │ I      │ 4p-1  │ 1698  │ M6 - 3^3 / 2^4 │ 906   │
    │ G4  │ II     │ 4p-1  │ 1698  │ Eb5  │ I      │ d5p-1 │ 1788  │ m6 - 2^7 / 3^4 │ 792   │
    │ A4  │ II     │ 5p-1  │ 1902  │ F5   │ I      │ m6p-1 │ 1992  │ m6 - 2^7 / 3^4 │ 792   │
    │ Bb4 │ II     │ m6p-1 │ 1992  │ G5   │ I      │ m7p-1 │ 2196  │ M6 - 3^3 / 2^4 │ 906   │
    │ C5  │ II     │ m7p-1 │ 2196  │ A5   │ I      │ 0-2   │ 2400  │ M6 - 3^3 / 2^4 │ 906   │
    │ D5  │ II     │ 0-2   │ 2400  │ Bb5  │ I      │ m2p-2 │ 2490  │ m6 - 2^7 / 3^4 │ 792   │
    │ Eb5 │ II     │ m2p-2 │ 2490  │ C6   │ I      │ m3p-2 │ 2694  │ M6 - 3^3 / 2^4 │ 906   │
    │ F5  │ II     │ m3p-2 │ 2694  │ D6   │ I      │ 4p-2  │ 2898  │ M6 - 3^3 / 2^4 │ 906   │
    │ G5  │ II     │ 4p-2  │ 2898  │ Eb6  │ I      │ d5p-2 │ 2988  │ m6 - 2^7 / 3^4 │ 792   │
    │ A5  │ II     │ 5p-2  │ 3102  │ F6   │ I      │ m6p-2 │ 3192  │ m6 - 2^7 / 3^4 │ 792   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;

let%expect_test "b_major" =
  let t = force Pythagorean.t in
  let scale = make_major_scale ~from:Scales.lower_b in
  print_endline (System.Double_stops.to_ascii_table t scale);
  [%expect
    {|
    ┌─────┬────────┬───────┬───────┬──────┬────────┬───────┬───────┬────────────────┬───────┐
    │ Low │ String │ Pos   │ Cents │ High │ String │ Pos   │ Cents │ Interval       │ Cents │
    ├─────┼────────┼───────┼───────┼──────┼────────┼───────┼───────┼────────────────┼───────┤
    │ B2  │ III    │ M3p   │ 408   │ G#3  │ II     │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ C#3 │ III    │ A4p   │ 612   │ A#3  │ II     │ A5p   │ 816   │ M6 - 3^3 / 2^4 │ 906   │
    │ D#3 │ II     │ A1p   │ 114   │ B3   │ I      │ M2p   │ 204   │ m6 - 2^7 / 3^4 │ 792   │
    │ E3  │ II     │ M2p   │ 204   │ C#4  │ I      │ M3p   │ 408   │ M6 - 3^3 / 2^4 │ 906   │
    │ F#3 │ II     │ M3p   │ 408   │ D#4  │ I      │ A4p   │ 612   │ M6 - 3^3 / 2^4 │ 906   │
    │ G#3 │ II     │ A4p   │ 612   │ E4   │ I      │ 5p    │ 702   │ m6 - 2^7 / 3^4 │ 792   │
    │ A#3 │ II     │ A5p   │ 816   │ F#4  │ I      │ M6p   │ 906   │ m6 - 2^7 / 3^4 │ 792   │
    │ B3  │ II     │ M6p   │ 906   │ G#4  │ I      │ M7p   │ 1110  │ M6 - 3^3 / 2^4 │ 906   │
    │ C#4 │ II     │ M7p   │ 1110  │ A#4  │ I      │ A1p-1 │ 1314  │ M6 - 3^3 / 2^4 │ 906   │
    │ D#4 │ II     │ A1p-1 │ 1314  │ B4   │ I      │ M2p-1 │ 1404  │ m6 - 2^7 / 3^4 │ 792   │
    │ E4  │ II     │ M2p-1 │ 1404  │ C#5  │ I      │ M3p-1 │ 1608  │ M6 - 3^3 / 2^4 │ 906   │
    │ F#4 │ II     │ M3p-1 │ 1608  │ D#5  │ I      │ A4p-1 │ 1812  │ M6 - 3^3 / 2^4 │ 906   │
    │ G#4 │ II     │ A4p-1 │ 1812  │ E5   │ I      │ 5p-1  │ 1902  │ m6 - 2^7 / 3^4 │ 792   │
    │ A#4 │ II     │ A5p-1 │ 2016  │ F#5  │ I      │ M6p-1 │ 2106  │ m6 - 2^7 / 3^4 │ 792   │
    │ B4  │ II     │ M6p-1 │ 2106  │ G#5  │ I      │ M7p-1 │ 2310  │ M6 - 3^3 / 2^4 │ 906   │
    │ C#5 │ II     │ M7p-1 │ 2310  │ A#5  │ I      │ A1p-2 │ 2514  │ M6 - 3^3 / 2^4 │ 906   │
    │ D#5 │ II     │ A1p-2 │ 2514  │ B5   │ I      │ M2p-2 │ 2604  │ m6 - 2^7 / 3^4 │ 792   │
    │ E5  │ II     │ M2p-2 │ 2604  │ C#6  │ I      │ M3p-2 │ 2808  │ M6 - 3^3 / 2^4 │ 906   │
    │ F#5 │ II     │ M3p-2 │ 2808  │ D#6  │ I      │ A4p-2 │ 3012  │ M6 - 3^3 / 2^4 │ 906   │
    │ G#5 │ II     │ A4p-2 │ 3012  │ E6   │ I      │ 5p-2  │ 3102  │ m6 - 2^7 / 3^4 │ 792   │
    └─────┴────────┴───────┴───────┴──────┴────────┴───────┴───────┴────────────────┴───────┘ |}]
;;
